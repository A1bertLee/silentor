!function(e){"use strict";function t(e){return-1!==e.indexOf("//")}function a(e){return e.slice(0,e.lastIndexOf("/")+1)}function r(e){return-1!==e.toLowerCase().indexOf(".md")||-1!==e.toLowerCase().indexOf(".markdown")}function n(t,a){e(window).trigger(t,a)}function i(e,t){"/"==e[e.length-1]&&(e=e.substring(0,e.length-1));var a=e.split("/"),r=t.split("/");if("."==r[0])r.splice(0,1);else{if(".."!=r[0])return-1!=r[0].indexOf("http")||-1!=r[0].indexOf("https")?t:a.join("/")+"/"+r.join("/");a.splice(a.length-1,1),r.splice(0,1)}return i(a.join("/"),r.join("/"))}function o(s,f,d,p){var p=p||l,d=d||!1,g=p+f;e.ajax({type:"GET",url:g,success:function(o){marked.setOptions({highlight:function(e){return hljs.highlightAuto(e).value}});var f=e(s);if(f.html(marked(o)),f.find("[href]").each(function(){var n=e(this),o=n.attr("href");if(t(o)&&n.attr("target","_blank"),d&&r(o)&&n.attr("href","?p="+o),!t(o)&&!d&&r(o)){var s=a(m);0==o.indexOf("../")?s=i(a(m),o):0==o.indexOf("__P__")?s=o.replace("__P__/",""):s+=o.replace("./",""),n.attr("href","?p="+s)}}),!d){var c=e("#main-page").find("h1, h2, h3, h4, h5, h6").first().text();e("title").text(c),e.each(f.find("img"),function(t,a){var r=e(a).attr("alt")||"";-1!=r.indexOf("|left")?e(a).addClass("img-left"):-1!=r.indexOf("|right")?e(a).addClass("img-right"):e(a).addClass("img-center")})}d&&(f.find("img").first().addClass("avatar"),e.each(f.find("li"),function(t,a){e(a).addClass("sidebar-item")})),e.each(f.find("img"),function(t,r){var n=e(r);if(0==n.attr("src").indexOf("__IMG__"))n.attr("src",n.attr("src").replace("__IMG__",h));else{var o=i(a(g),n.attr("src"));n.attr("src",o)}}),"#sidebar-page"==s?n("loaded-sidebar-page"):"#main-page"==s?n("loaded-main-page"):"#main-page-footer"==s&&n("loaded-main-page-footer")},error:function(e){if(404===e.status){if("footer.md"===f)return void console.log("没有找到footer.md! 建议在p/目录下建立footer.md 文件来添加底部信息！");o("#main-page","404.md",!1,"/"+c+"/"),n("page-not-found",{selector:s,path:f})}}})}function s(t){e.ajax({method:"GET",url:"config.json",success:function(a){c=a.app_name||c,h=a.img_root||h;var r=a.description||"";p=a.markdown_root||p,l="/"+c+"/"+p+"/",e("meta[name=description]").first().attr("content",r),t()},error:function(e){alert("读取配置有误")}})}function f(e){var t=document.createElement("a");t.href=e;var a=function(e){if(!e)return{};var t={};e=e.slice(1).split("&");for(var a,r=0;r<e.length;r++){a=e[r].split("=");var n=a[0],i=a[1];/\[\]$/.test(n)?(t[n]=t[n]||[],t[n].push(i)):t[n]=i}return t};return{protocol:t.protocol,host:t.host,hostname:t.hostname,pathname:t.pathname,search:a(t.search),hash:t.hash}}function d(){s(function(){n("before-load-sidebar-page"),o("#sidebar-page","sidebar.md",!0),n("before-load-main-page-footer"),o("#main-page-footer","footer.md");var e=f(window.location.href);m=e.search.p||"","/"===m.charAt(m.length-1)&&(m=m.slice(0,location.search.length-2)),""!==m&&r(m)?(n("before-load-main-page"),o("#main-page",m)):(n("before-load-main-page"),o("#main-page","home.md"))})}var c="",l="",h="img",p="p",m="";d()}(Zepto);